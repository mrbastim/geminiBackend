# Integration Tests

Интеграционные тесты для Gemini Backend API.

## Запуск тестов

```bash
# Запустить все тесты
go test -v ./tests/

# Запустить с покрытием
go test -v -cover ./tests/

# Запустить конкретный тест
go test -v ./tests/ -run TestRegisterAndLogin
```

## Описание тестов

### TestHealthCheck
Базовый тест работоспособности фреймворка Gin.

### TestRegisterAndLogin
Проверяет процесс регистрации и авторизации пользователя:
- Регистрация нового пользователя
- Вход в систему
- Получение JWT токена

### TestAIKeyManagement
Тестирует управление API ключами Gemini:
- Проверка статуса ключа (изначально false)
- Установка нового ключа
- Проверка статуса (должен быть true)
- Удаление ключа
- Проверка статуса (снова false)

### TestAITextGeneration
Проверяет работу AI эндпоинта:
- Попытка запроса без ключа (должна вернуть ошибку missing_api_key)
- Установка ключа
- Попытка запроса с ключом (не должна возвращать missing_api_key)

### TestUnauthorizedAccess
Проверяет защиту эндпоинтов от несанкционированного доступа:
- Попытка доступа к защищённым эндпоинтам без токена
- Ожидается HTTP 401

### TestInvalidToken
Проверяет обработку невалидного JWT токена:
- Попытка доступа с поддельным токеном
- Ожидается HTTP 401

## Примечания

- Каждый тест создаёт временную SQLite базу данных
- База удаляется после завершения теста
- Тесты изолированы друг от друга
- Используется `gin.TestMode` для минимизации вывода

## Расширение тестов

Для добавления нового теста:

1. Создайте функцию `func TestXxx(t *testing.T)` в `integration_test.go`
2. Используйте `setupTestServer(t)` для инициализации
3. Не забудьте вызвать `defer cleanup()` для очистки
